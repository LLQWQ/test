import{r as w,o as S,c as B,a as x,b as H,w as C,d as A,t as j}from"./index.35e1b9dc.js";import{B as O}from"./index.33951877.js";(function(d){typeof exports=="object"?module.exports=d():typeof define=="function"&&define.amd?define(d):window.Vudio=d()})(function(){var d={effect:"waveform",accuracy:128,width:256,height:100,waveform:{maxHeight:80,minHeight:1,spacing:1,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle",prettify:!0},lighting:{maxHeight:80,lineWidth:0,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle"}};function u(t,i,e){if(["[object HTMLAudioSource]","[object HTMLAudioElement]","[object MediaStream]"].indexOf(Object.prototype.toString.call(t))===-1)throw new TypeError("Invaild Audio Source");if(Object.prototype.toString.call(i)!=="[object HTMLCanvasElement]")throw new TypeError("Invaild Canvas Element");this.audioSrc=t,this.canvasEle=i,this.option=p(d,e),this.meta={},this.stat=0,this.freqByteData=null,this.__init()}function p(){var t={};return Array.prototype.forEach.call(arguments,function(i){var e;for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(Object.prototype.toString.call(i[e])==="[object Object]"?t[e]=p(t[e],i[e]):t[e]=i[e])}),t}return u.prototype={__init:function(){var t=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),i=Object.prototype.toString.call(this.audioSrc)!=="[object MediaStream]"?t.createMediaElementSource(this.audioSrc):t.createMediaStreamSource(this.audioSrc),e=window.devicePixelRatio||1;this.analyser=t.createAnalyser(),this.meta.spr=t.sampleRate,i.connect(this.analyser),this.analyser.fftSize=this.option.accuracy*2,this.analyser.connect(t.destination),this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.context2d=this.canvasEle.getContext("2d"),this.width=this.option.width,this.height=this.option.height,this.context2d.canvas.width=this.width*e,this.context2d.canvas.height=this.height*e,this.context2d.scale(e,e)},__rebuildData:function(t,i){var e;return i==="center"?e=[].concat(Array.from(t).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(t).splice(0,this.option.accuracy/2)):i==="left"?e=t:i==="right"?e=Array.from(t).reverse():e=[].concat(Array.from(t).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(t).splice(0,this.option.accuracy/2)),e},__animate:function(){this.stat===1&&(this.analyser.getByteFrequencyData(this.freqByteData),typeof this.__effects()[this.option.effect]=="function"&&this.__effects()[this.option.effect](this.freqByteData),requestAnimationFrame(this.__animate.bind(this)))},__testFrame:function(){this.analyser.getByteFrequencyData(this.freqByteData),typeof this.__effects()[this.option.effect]=="function"&&this.__effects()[this.option.effect](this.freqByteData)},__effects:function(){var t=this;return{lighting:function(i){var e=t.option.lighting,s=t.__rebuildData(i,e.horizontalAlign),n=e.maxHeight/2,g=!0,c,a;e.horizontalAlign,t.context2d.clearRect(0,0,t.width,t.height),t.context2d.lineWidth=e.lineWidth,t.context2d.strokeStyle=e.color,t.context2d.beginPath(),s.forEach(function(o,l){c=t.width/t.option.accuracy*l,a=o/256*n,e.verticalAlign==="middle"?a=(t.height-o)/2-n/2:e.verticalAlign==="bottom"?a=t.height-o:e.verticalAlign==="top"?a=o:a=(t.height-o)/2-n/2,g?(t.context2d.moveTo(c,a),g=!1):t.context2d.lineTo(c,a)}),t.context2d.stroke()},waveform:function(i){var e=t.option.waveform,s=e.fadeSide,n=e.prettify,g=t.__rebuildData(i,e.horizontalAlign),c,a,o,l,h,r,m,y;e.horizontalAlign!=="center"&&(s=!1,n=!1),t.context2d.clearRect(0,0,t.width,t.height),g.forEach(function(b,f){a=(t.width-t.option.accuracy*e.spacing)/t.option.accuracy,l=f*(a+e.spacing),e.spacing!==1&&(l+=e.spacing/2),n?f<=t.option.accuracy/2?c=(1-(t.option.accuracy/2-1-f)/(t.option.accuracy/2))*e.maxHeight:c=(1-(f-t.option.accuracy/2)/(t.option.accuracy/2))*e.maxHeight:c=e.maxHeight,o=b/256*c,o=o<e.minHeight?e.minHeight:o,e.verticalAlign==="middle"?h=(t.height-o)/2:e.verticalAlign==="top"?h=0:e.verticalAlign==="bottom"?h=t.height-o:h=(t.height-o)/2,r=e.color,r instanceof Array?(m=t.context2d.createLinearGradient(l,h,l,h+o),r.forEach(function(_,v){_ instanceof Array?(y=_[0],_=_[1]):v===0||v===r.length-1?y=v/(r.length-1):y=v/r.length+.5/r.length,m.addColorStop(y,_)}),t.context2d.fillStyle=m):t.context2d.fillStyle=r,e.shadowBlur>0&&(t.context2d.shadowBlur=e.shadowBlur,t.context2d.shadowColor=e.shadowColor),s?f<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-f)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(f-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1,t.context2d.fillRect(l,h,a,o)})}}},dance:function(){return this.stat===0&&(this.stat=1,this.__animate()),this},pause:function(){return this.stat=0,this},setOption:function(t){this.option=p(this.option,t)}},u});const D={class:"home"},k={__name:"Home",setup(d){const u=w(null),p=w(null),t=w(null),i=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{console.log("",11111),console.log("",e),u.value.srcObject=e,u.value.play()}).catch(e=>{e.value=e,console.log("",e)}),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{var s=new Vudio(e,t.value,{accuracy:256,width:1024,height:200,waveform:{fadeSide:!1,maxHeight:200,verticalAlign:"middle",horizontalAlign:"center",color:"#2980b9"}});s.dance()}).catch(e=>{e.value=e,console.log("",e)})};return(e,s)=>{const n=O;return S(),B("div",null,[x("div",D,[H(n,{type:"primary",onClick:i},{default:C(()=>[A("\u6253\u5F00\u6444\u50CF\u5934")]),_:1})]),x("video",{ref_key:"video",ref:u},null,512),x("canvas",{ref_key:"canvas",ref:t},null,512),A(" "+j(p.value)+"11 ",1)])}}};export{k as default};
