import{r as w,o as S,c as B,a as x,b as C,w as H,d as A,t as j}from"./index.3da0c870.js";import{B as O}from"./index.ee43d29a.js";import"./index.5f14e09e.js";(function(u){typeof exports=="object"?module.exports=u():typeof define=="function"&&define.amd?define(u):window.Vudio=u()})(function(){var u={effect:"waveform",accuracy:128,width:256,height:100,waveform:{maxHeight:80,minHeight:1,spacing:1,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle",prettify:!0},lighting:{maxHeight:80,lineWidth:0,color:"#f00",shadowBlur:0,shadowColor:"#f00",fadeSide:!0,horizontalAlign:"center",verticalAlign:"middle"}};function p(t,i,e){if(["[object HTMLAudioSource]","[object HTMLAudioElement]","[object MediaStream]"].indexOf(Object.prototype.toString.call(t))===-1)throw new TypeError("Invaild Audio Source");if(Object.prototype.toString.call(i)!=="[object HTMLCanvasElement]")throw new TypeError("Invaild Canvas Element");this.audioSrc=t,this.canvasEle=i,this.option=_(u,e),this.meta={},this.stat=0,this.freqByteData=null,this.__init()}function _(){var t={};return Array.prototype.forEach.call(arguments,function(i){var e;for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(Object.prototype.toString.call(i[e])==="[object Object]"?t[e]=_(t[e],i[e]):t[e]=i[e])}),t}return p.prototype={__init:function(){var t=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),i=Object.prototype.toString.call(this.audioSrc)!=="[object MediaStream]"?t.createMediaElementSource(this.audioSrc):t.createMediaStreamSource(this.audioSrc),e=window.devicePixelRatio||1;this.analyser=t.createAnalyser(),this.meta.spr=t.sampleRate,i.connect(this.analyser),this.analyser.fftSize=this.option.accuracy*2,this.analyser.connect(t.destination),this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.context2d=this.canvasEle.getContext("2d"),this.width=this.option.width,this.height=this.option.height,this.context2d.canvas.width=this.width*e,this.context2d.canvas.height=this.height*e,this.context2d.scale(e,e)},__rebuildData:function(t,i){var e;return i==="center"?e=[].concat(Array.from(t).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(t).splice(0,this.option.accuracy/2)):i==="left"?e=t:i==="right"?e=Array.from(t).reverse():e=[].concat(Array.from(t).reverse().splice(this.option.accuracy/2,this.option.accuracy/2),Array.from(t).splice(0,this.option.accuracy/2)),e},__animate:function(){this.stat===1&&(this.analyser.getByteFrequencyData(this.freqByteData),typeof this.__effects()[this.option.effect]=="function"&&this.__effects()[this.option.effect](this.freqByteData),requestAnimationFrame(this.__animate.bind(this)))},__testFrame:function(){this.analyser.getByteFrequencyData(this.freqByteData),typeof this.__effects()[this.option.effect]=="function"&&this.__effects()[this.option.effect](this.freqByteData)},__effects:function(){var t=this;return{lighting:function(i){var e=t.option.lighting,l=t.__rebuildData(i,e.horizontalAlign),r=e.maxHeight/2,c=!0,a,n;e.horizontalAlign,t.context2d.clearRect(0,0,t.width,t.height),t.context2d.lineWidth=e.lineWidth,t.context2d.strokeStyle=e.color,t.context2d.beginPath(),l.forEach(function(o,h){a=t.width/t.option.accuracy*h,n=o/256*r,e.verticalAlign==="middle"?n=(t.height-o)/2-r/2:e.verticalAlign==="bottom"?n=t.height-o:e.verticalAlign==="top"?n=o:n=(t.height-o)/2-r/2,c?(t.context2d.moveTo(a,n),c=!1):t.context2d.lineTo(a,n)}),t.context2d.stroke()},waveform:function(i){var e=t.option.waveform,l=e.fadeSide,r=e.prettify,c=t.__rebuildData(i,e.horizontalAlign),a,n,o,h,f,s,m,y;e.horizontalAlign!=="center"&&(l=!1,r=!1),t.context2d.clearRect(0,0,t.width,t.height),c.forEach(function(b,d){n=(t.width-t.option.accuracy*e.spacing)/t.option.accuracy,h=d*(n+e.spacing),e.spacing!==1&&(h+=e.spacing/2),r?d<=t.option.accuracy/2?a=(1-(t.option.accuracy/2-1-d)/(t.option.accuracy/2))*e.maxHeight:a=(1-(d-t.option.accuracy/2)/(t.option.accuracy/2))*e.maxHeight:a=e.maxHeight,o=b/256*a,o=o<e.minHeight?e.minHeight:o,e.verticalAlign==="middle"?f=(t.height-o)/2:e.verticalAlign==="top"?f=0:e.verticalAlign==="bottom"?f=t.height-o:f=(t.height-o)/2,s=e.color,s instanceof Array?(m=t.context2d.createLinearGradient(h,f,h,f+o),s.forEach(function(g,v){g instanceof Array?(y=g[0],g=g[1]):v===0||v===s.length-1?y=v/(s.length-1):y=v/s.length+.5/s.length,m.addColorStop(y,g)}),t.context2d.fillStyle=m):t.context2d.fillStyle=s,e.shadowBlur>0&&(t.context2d.shadowBlur=e.shadowBlur,t.context2d.shadowColor=e.shadowColor),l?d<=t.option.accuracy/2?t.context2d.globalAlpha=1-(t.option.accuracy/2-1-d)/(t.option.accuracy/2):t.context2d.globalAlpha=1-(d-t.option.accuracy/2)/(t.option.accuracy/2):t.context2d.globalAlpha=1,t.context2d.fillRect(h,f,n,o)})}}},dance:function(){return this.stat===0&&(this.stat=1,this.__animate()),this},pause:function(){return this.stat=0,this},setOption:function(t){this.option=_(this.option,t)}},p});const D={class:"home"},E=A("\u6253\u5F00\u6444\u50CF\u5934"),z={setup(u){const p=w(null),_=w(null),t=w(null),i=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{console.log("",11111),console.log("",e),p.value.srcObject=e,p.value.play()}).catch(e=>{e.value=e,console.log("",e)}),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{var l=new Vudio(e,t.value,{accuracy:256,width:1024,height:200,waveform:{fadeSide:!1,maxHeight:200,verticalAlign:"middle",horizontalAlign:"center",color:"#2980b9"}});l.dance()}).catch(e=>{e.value=e,console.log("",e)})};return(e,l)=>{const r=O;return S(),B("div",null,[x("div",D,[C(r,{type:"primary",onClick:i},{default:H(()=>[E]),_:1})]),x("video",{ref:(c,a)=>{a.video=c,p.value=c}},null,512),x("canvas",{ref:(c,a)=>{a.canvas=c,t.value=c}},null,512),A(" "+j(_.value)+"11 ",1)])}}};export{z as default};
